:root { --primary: #6366f1; --dark: #1e293b; }
body { font-family: sans-serif; background: #f1f5f9; display: flex; justify-content: center; padding: 20px; }
.app-container { background: white; padding: 20px; border-radius: 20px; width: 360px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
.budget-setup { margin-bottom: 15px; padding: 10px; background: #eef2ff; border-radius: 12px; display: flex; justify-content: space-between; align-items: center; }
.budget-setup input { width: 100px; border: none; border-bottom: 2px solid var(--primary); text-align: right; background: transparent; font-weight: bold; font-size: 1.1rem; }
.input-section { display: flex; gap: 4px; margin-bottom: 10px; }
input, select { padding: 8px; border: 1px solid #cbd5e1; border-radius: 6px; font-size: 0.8rem; }
#itemName { flex: 2; }
#itemPrice { width: 60px; }
#addBtn { background: var(--primary); color: white; border: none; padding: 8px 12px; border-radius: 6px; cursor: pointer; }
.view-selector { display: flex; justify-content: center; gap: 8px; margin-bottom: 10px; }
.view-selector button { background: #e2e8f0; border: none; padding: 4px 12px; border-radius: 15px; cursor: pointer; font-size: 0.7rem; }
.view-selector button.active { background: var(--primary); color: white; }
.chart-container { height: 180px; margin-bottom: 15px; }
.status-board { padding: 15px; background: var(--dark); color: white; border-radius: 15px; }
.status-item { display: flex; justify-content: space-between; margin-bottom: 5px; }
.highlight { font-size: 1.1rem; font-weight: bold; border-top: 1px solid #475569; padding-top: 8px; }
.negative { color: #ef4444; }
.secondary { width: 100%; margin-top: 10px; background: #64748b; color: white; border: none; padding: 10px; border-radius: 8px; cursor: pointer; }
ul { list-style: none; padding: 0; max-height: 100px; overflow-y: auto; margin-bottom: 10px; }
li { display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid #f1f5f9; font-size: 0.85rem; }
.badge { padding: 2px 5px; border-radius: 4px; color: white; font-size: 0.65rem; margin-right: 5px; }
.bg-food { background: #fb923c; } .bg-daily { background: #34d399; } .bg-hobby { background: #f472b6; } .bg-other { background: #94a3b8; }

// 既存のコードの下の方に追加

document.getElementById('findStoresBtn').addEventListener('click', function() {
  const mapElement = document.getElementById('map');
  mapElement.style.display = 'block'; // 地図を表示

  // 1. 現在地を取得
  if (!navigator.geolocation) {
    alert("お使いのブラウザは位置情報に対応していません");
    return;
  }

  navigator.geolocation.getCurrentPosition((position) => {
    const lat = position.coords.latitude;
    const lon = position.coords.longitude;

    // 2. 地図を表示
    const map = L.map('map').setView([lat, lon], 15);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '© OpenStreetMap contributors'
    }).addTo(map);

    // 3. 現在地にピンを立てる
    L.marker([lat, lon]).addTo(map).bindPopup('あなたの場所').openPopup();

    // 4. 周辺のスーパーを検索（外部サービス Overpass API を使用）
    fetch(`https://overpass-api.de/api/interpreter?data=[out:json];node["shop"="supermarket"](around:2000,${lat},${lon});out;`)
      .then(response => response.json())
      .then(data => {
        data.elements.forEach(store => {
          L.marker([store.lat, store.lon])
            .addTo(map)
            .bindPopup(store.tags.name || 'スーパー');
        });
      });
    
    // 二度押しできないようにボタンを隠すか無効化
    this.style.display = 'none';
    
  }, () => {
    alert("位置情報の取得に失敗しました。設定を確認してください。");
  });
});
